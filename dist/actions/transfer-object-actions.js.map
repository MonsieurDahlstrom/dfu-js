{"version":3,"sources":["../../src/actions/transfer-object-actions.js"],"names":["MutationTypes","DATA_CHUNK_SIZE","TransferObjectActions","webBluetoothDFUObjectAdd","transferObject","dispatch","commit","ADD_TRANSFER_OBJECT","webBluetoothDFUObjectRemove","REMOVE_TRANSFER_OBJECT","webBluetoothDFUObjectBegin","state","Creating","write","Verify","type","transfer","controlPoint","UPDATE_TRANSFER_OBJECT","webBluetoothDFUObjectToPackets","payload","console","log","offset","parentFileEnd","length","parentFileBegin","index","chunkBegin","chunkEnd","chunk","file","slice","chunks","push","webBluetoothDFUObjectTransferDataPackages","buffer","Package","packetPoint","webBluetoothDFUObjectValidate","checksum","fileCRCToOffset","crc32","Storing","Execute","Create","Transfering","webBluetoothDFUObjectSetPacketReturnNotification","PacketReturnNotification","webBluetoothDFUObjectHandleEvent","dataView","opCode","getInt8","responseCode","webBluetoothDFUObjectHandleEventWhileCreating","Actions","SELECT","Responses","SUCCESS","getUint32","CREATE","SET_PRN","webBluetoothDFUObjectHandleEventWhileTransfering","CALCULATE_CHECKSUM","webBluetoothDFUObjectHandleEventWhileStoring","EXECUTE","Completed"],"mappings":"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","file":"transfer-object-actions.js","sourcesContent":["import crc from 'crc'\n//\nimport Write from '../models/write'\n//\nimport * as MutationTypes from '../mutation-types'\nimport {TransferObjectState} from '../models/transfer-object'\n\nconst DATA_CHUNK_SIZE = 20\n\nconst TransferObjectActions = {\n\n  /** Adding a TransferObject to the vuex state **/\n  async webBluetoothDFUObjectAdd({ dispatch, commit }, transferObject) {\n    commit(MutationTypes.ADD_TRANSFER_OBJECT, transferObject)\n  },\n\n  /* Remove a TransferObject from the vuex state */\n  async webBluetoothDFUObjectRemove({ dispatch, commit }, transferObject) {\n    commit(MutationTypes.REMOVE_TRANSFER_OBJECT, transferObject)\n  },\n\n  /** The first step in transferring this object, ask how much has already been transferred **/\n  async webBluetoothDFUObjectBegin({ dispatch, commit }, transferObject) {\n    transferObject.state = TransferObjectState.Creating\n    let write = new Write.Verify(transferObject.type,transferObject.transfer.controlPoint)\n    write.transferObject = transferObject\n    dispatch('webBluetoothDFUScheduleWrite',write)\n    dispatch('webBluetoothDFUExecuteWrite', write)\n    commit(MutationTypes.UPDATE_TRANSFER_OBJECT, transferObject)\n  },\n\n  /**\n    Internal convinence methods, a transfer object might have been partially\n    transfered already, if so the offset passed in as none zero.\n\n    Based on the offset and length into the Transfer objects file and the given\n    offset in this range, create the number of chunks needed.\n  **/\n  async webBluetoothDFUObjectToPackets({ dispatch, commit }, payload) {\n    console.log('  webBluetoothDFUObjectToPackets')\n    console.log(payload)\n    let transferObject = payload.transferObject\n    let offset = payload.offset\n    let parentFileEnd = transferObject.offset + transferObject.length\n    let parentFileBegin = transferObject.offset + offset\n    let index = parentFileBegin\n    while (index < parentFileEnd) {\n      let chunkBegin = index\n      let chunkEnd = chunkBegin + DATA_CHUNK_SIZE < parentFileEnd ? chunkBegin + DATA_CHUNK_SIZE : chunkBegin + (parentFileEnd - index)\n      let chunk = transferObject.transfer.file.slice(chunkBegin, chunkEnd)\n      transferObject.chunks.push(chunk)\n      index += DATA_CHUNK_SIZE\n    }\n    commit(MutationTypes.UPDATE_TRANSFER_OBJECT, transferObject)\n  },\n\n  /** Slots all data chunks for transmission, the queue inside Transfer ensures the order **/\n  async webBluetoothDFUObjectTransferDataPackages({ dispatch, commit }, transferObject) {\n    console.log('  webBluetoothDFUObjectTransferDataPackages');\n    for (let index = 0; index < transferObject.chunks.length; index++) {\n      let buffer = transferObject.chunks[index]\n      let write = new Write.Package(transferObject.transfer.packetPoint, buffer)\n      write.transferObject = transferObject\n      await dispatch('webBluetoothDFUScheduleWrite', write)\n      await dispatch('webBluetoothDFUExecuteWrite', write)\n    }\n    commit(MutationTypes.UPDATE_TRANSFER_OBJECT, transferObject)\n  },\n\n  /** Given an offset & checksum, take the appropirate next action **/\n  async webBluetoothDFUObjectValidate({ dispatch, commit }, payload) {\n    console.log('  webBluetoothDFUObjectValidate')\n    var transferObject = payload.transferObject\n    var offset = payload.offset\n    var checksum = payload.checksum\n    /** The checksum reported back from a NRF51/52 is a crc of the Transfer object's file up till the offset */\n    let fileCRCToOffset = crc.crc32(transferObject.transfer.file.slice(0, offset))\n    if (offset === transferObject.offset + transferObject.length && checksum === fileCRCToOffset) {\n      console.log('    Transfer complete')\n      /** Object has been transfered and should be moved into its right place on the device **/\n      transferObject.state = TransferObjectState.Storing\n      let write = new Write.Execute(transferObject.transfer.packetPoint)\n      write.transferObject = transferObject\n      dispatch('webBluetoothDFUScheduleWrite', write)\n    } else if (offset === transferObject.offset || offset > transferObject.offset + transferObject.length || checksum !== fileCRCToOffset) {\n      console.log('    Transfer needs to be created')\n      /** This object has not been trasnfered to the device or is faulty, recreate and transfer a new **/\n      transferObject.state = TransferObjectState.Creating\n      let write = new Write.Create(transferObject.transfer.controlPoint,transferObject.type,transferObject.length)\n      write.transferObject = transferObject\n      dispatch('webBluetoothDFUScheduleWrite', write)\n    } else {\n      console.log('    Initiate package transfer')\n      /** its the right object on the device but it has not been transfred fully **/\n      transferObject.state = TransferObjectState.Transfering\n      dispatch('webBluetoothDFUObjectToPackets', {transferObject:transferObject, offset:offset})\n      dispatch('webBluetoothDFUObjectSetPacketReturnNotification', transferObject)\n      dispatch('webBluetoothDFUObjectTransferDataPackages', transferObject)\n    }\n    commit(MutationTypes.UPDATE_TRANSFER_OBJECT, transferObject)\n  },\n\n  /** Request a notification when all packets for this transferObject has been received on the device **/\n  async webBluetoothDFUObjectSetPacketReturnNotification({ dispatch, commit }, transferObject) {\n    console.log('  webBluetoothDFUObjectSetPacketReturnNotification');\n    let write = new Write.PacketReturnNotification(transferObject.transfer.packetPoint,transferObject.chunks.length)\n    write.transferObject = transferObject\n    dispatch('webBluetoothDFUScheduleWrite', write)\n    commit(MutationTypes.UPDATE_TRANSFER_OBJECT, transferObject)\n  },\n\n  /** handles events received on the Control Point Characteristic **/\n  async webBluetoothDFUObjectHandleEvent ({ dispatch, commit }, payload) {\n    console.log('  webBluetoothDFUObjectHandleEvent');\n    let dataView = payload.dataView\n    let transferObject = payload.transferObject\n    /** Depending on which state this object is handle the relevent opcodes */\n    payload.opCode = dataView.getInt8(1)\n    payload.responseCode = dataView.getInt8(2)\n    switch (transferObject.state) {\n      case TransferObjectState.Creating:\n        dispatch('webBluetoothDFUObjectHandleEventWhileCreating', payload)\n        break\n      case TransferObjectState.Transfering:\n        dispatch('webBluetoothDFUObjectHandleEventWhileTransfering', payload)\n        break\n      case TransferObjectState.Storing: {\n        dispatch('webBluetoothDFUObjectHandleEventWhileStoring', payload)\n        break\n      }\n    }\n  },\n\n  async webBluetoothDFUObjectHandleEventWhileCreating ({ dispatch, commit }, payload) {\n    console.log('  webBluetoothDFUObjectHandleEventWhileCreating')\n    if (payload.opCode === Write.Actions.SELECT && payload.responseCode === Write.Responses.SUCCESS) {\n      console.log('    SELECT SUCCESS')\n      /** verify how much how the transfer that has been completed */\n      payload.offset = payload.dataView.getUint32(7, true)\n      payload.checksum = payload.dataView.getUint32(11, true)\n      dispatch('webBluetoothDFUObjectValidate', payload)\n      commit(MutationTypes.UPDATE_TRANSFER_OBJECT, payload.transferObject)\n    } else if (payload.opCode === Write.Actions.CREATE && payload.responseCode === Write.Responses.SUCCESS) {\n      console.log('    CREATE SUCCESS')\n      payload.transferObject.state = TransferObjectState.Transfering\n      /** start the transfer of the object  */\n      payload.offset = 0\n      dispatch('webBluetoothDFUObjectToPackets', payload)\n      dispatch('webBluetoothDFUObjectSetPacketReturnNotification', payload.transferObject)\n      dispatch('webBluetoothDFUObjectTransferDataPackages', payload.transferObject)\n      commit(MutationTypes.UPDATE_TRANSFER_OBJECT, payload.transferObject)\n    } else if (payload.opCode === Write.Actions.SET_PRN && payload.responseCode === Write.Responses.SUCCESS) {\n      //\n      console.log('    PRN SUCCESS')\n    } else {\n      console.log('  Operation: ' + payload.opCode + ' Result: ' + payload.responseCode)\n    }\n  },\n\n  async webBluetoothDFUObjectHandleEventWhileTransfering ({ dispatch, commit }, payload) {\n    console.log('webBluetoothDFUObjectHandleEventWhileTransfering');\n    if (payload.opCode === Write.Actions.CALCULATE_CHECKSUM && payload.responseCode === Write.Responses.SUCCESS) {\n      /** verify how much how the transfer that has been completed */\n      payload.offset = payload.dataView.getUint32(7, true)\n      payload.checksum = payload.dataView.getUint32(11, true)\n      dispatch('webBluetoothDFUObjectValidate', payload)\n      commit(MutationTypes.UPDATE_TRANSFER_OBJECT, payload.transferObject)\n    } else if (payload.opCode === Write.Actions.SET_PRN && payload.responseCode === Write.Responses.SUCCESS) {\n      //NOP\n    } else {\n      console.log('  Operation: ' + payload.opCode + ' Result: ' + payload.responseCode)\n    }\n  },\n\n  async webBluetoothDFUObjectHandleEventWhileStoring ({ dispatch, commit }, payload) {\n    console.log('webBluetoothDFUObjectHandleEventWhileStoring');\n    if (payload.opCode === Write.Actions.EXECUTE && payload.responseCode === Write.Responses.SUCCESS) {\n      payload.transferObject.state = TransferObjectState.Completed\n      commit(MutationTypes.UPDATE_TRANSFER_OBJECT, payload.transferObject)\n    } else if (payload.opCode === Write.Actions.SET_PRN && payload.responseCode === Write.Responses.SUCCESS) {\n      //NOP\n    } else {\n      console.log('  Operation: ' + payload.opCode + ' Result: ' + payload.responseCode)\n    }\n  }\n}\n\nexport default TransferObjectActions\n"]}