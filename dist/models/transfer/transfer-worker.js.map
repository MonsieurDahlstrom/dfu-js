{"version":3,"sources":["../../../src/models/transfer/transfer-worker.js"],"names":["currentTransfer","undefined","CurrentTransfer","TransferWorker","task","onCompleition","Error","stateUpdateFunction","event","state","Failed","end","Completed","on","begin","module","exports"],"mappings":";;AAOA;;;;AACA;;;;;;AAEA,IAAIA,kBAAkBC,SAAtB;;AAEA,IAAMC,kBAAkB,SAAlBA,eAAkB,GAAW;AACjC,SAAOF,eAAP;AACD,CAFD;AAGA,IAAMG,iBAAiB,SAAjBA,cAAiB,CAAUC,IAAV,EAAgBC,aAAhB,EAA+B;AACpD,MAAID,uCAA6B,KAAjC,EAAwC;AACtC,UAAM,IAAIE,KAAJ,CAAU,0BAAV,CAAN;AACD;AACD,MAAI,CAACD,aAAL,EAAoB;AAClB,UAAM,IAAIC,KAAJ,CAAU,0BAAV,CAAN;AACD;AACDN,oBAAkBI,IAAlB;AACA,MAAIG,sBAAsB,SAAtBA,mBAAsB,CAACC,KAAD,EAAW;AACnC,QAAGA,MAAMC,KAAN,KAAgB,iBAAeC,MAAlC,EAA0C;AACxCL,oBAAc,iBAAd;AACAD,WAAKO,GAAL;AACAX,wBAAkBC,SAAlB;AACD,KAJD,MAIO,IAAIO,MAAMC,KAAN,KAAgB,iBAAeG,SAAnC,EAA8C;AACnDR,WAAKO,GAAL;AACAX,wBAAkBC,SAAlB;AACAI;AACD;AACF,GAVD;AAWAL,kBAAgBa,EAAhB,CAAmB,cAAnB,EAAmCN,mBAAnC;AACAP,kBAAgBc,KAAhB;AACD,CArBD;;AAuBAC,OAAOC,OAAP,CAAed,eAAf,GAAiCA,eAAjC;AACAa,OAAOC,OAAP,CAAeb,cAAf,GAAgCA,cAAhC","file":"transfer-worker.js","sourcesContent":["/**\nTransfer class represents a binary file inside a firmware update zip.\nA firmware update consists of a init package and data file. The StateMachine\nparases the zip file and creates a transfer object for each entry in the zip\n\nThe statemachine uses a queue to slot the Transfers in order\n**/\nimport Transfer from './transfer'\nimport TransferStates from './states'\n\nlet currentTransfer = undefined\n\nconst CurrentTransfer = function() {\n  return currentTransfer\n}\nconst TransferWorker = function (task, onCompleition) {\n  if (task instanceof Transfer === false) {\n    throw new Error('task is not of type Task')\n  }\n  if (!onCompleition) {\n    throw new Error('onCompleition is not set')\n  }\n  currentTransfer = task\n  let stateUpdateFunction = (event) => {\n    if(event.state === TransferStates.Failed) {\n      onCompleition('transfer failed')\n      task.end()\n      currentTransfer = undefined\n    } else if (event.state === TransferStates.Completed) {\n      task.end()\n      currentTransfer = undefined\n      onCompleition()\n    }\n  }\n  currentTransfer.on('stateChanged', stateUpdateFunction)\n  currentTransfer.begin()\n}\n\nmodule.exports.CurrentTransfer = CurrentTransfer\nmodule.exports.TransferWorker = TransferWorker\n"]}