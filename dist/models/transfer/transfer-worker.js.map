{"version":3,"sources":["../../../src/models/transfer/transfer-worker.js"],"names":["currentTransfer","undefined","CurrentTransfer","TransferWorker","task","onCompleition","Error","begin","intervalTimer","setInterval","state","Failed","clearInterval","end","Completed","module","exports"],"mappings":";;AAOA;;;;AACA;;;;;;AAEA,IAAIA,kBAAkBC,SAAtB;;AAEA,IAAMC,kBAAkB,SAAlBA,eAAkB,GAAW;AACjC,SAAOF,eAAP;AACD,CAFD;AAGA,IAAMG,iBAAiB,SAAjBA,cAAiB,CAAUC,IAAV,EAAgBC,aAAhB,EAA+B;AACpD,MAAID,uCAA6B,KAAjC,EAAwC;AACtC,UAAM,IAAIE,KAAJ,CAAU,0BAAV,CAAN;AACD;AACD,MAAI,CAACD,aAAL,EAAoB;AAClB,UAAM,IAAIC,KAAJ,CAAU,0BAAV,CAAN;AACD;AACDN,oBAAkBI,IAAlB;AACAA,OAAKG,KAAL;AACA,MAAMC,gBAAgBC,YAAY,YAAM;AACtC,QAAIL,KAAKM,KAAL,KAAe,iBAAeC,MAAlC,EAA0C;AACxCC,oBAAcJ,aAAd;AACAJ,WAAKS,GAAL;AACAb,wBAAkBC,SAAlB;AACAI,oBAAc,iBAAd;AACD,KALD,MAKO,IAAID,KAAKM,KAAL,KAAe,iBAAeI,SAAlC,EAA6C;AAClDF,oBAAcJ,aAAd;AACAJ,WAAKS,GAAL;AACAb,wBAAkBC,SAAlB;AACAI;AACD;AACF,GAZqB,EAYnB,GAZmB,CAAtB;AAaD,CAtBD;;AAwBAU,OAAOC,OAAP,CAAed,eAAf,GAAiCA,eAAjC;AACAa,OAAOC,OAAP,CAAeb,cAAf,GAAgCA,cAAhC","file":"transfer-worker.js","sourcesContent":["/**\r\nTransfer class represents a binary file inside a firmware update zip.\r\nA firmware update consists of a init package and data file. The StateMachine\r\nparases the zip file and creates a transfer object for each entry in the zip\r\n\r\nThe statemachine uses a queue to slot the Transfers in order\r\n**/\r\nimport Transfer from './transfer'\r\nimport TransferStates from './states'\r\n\r\nlet currentTransfer = undefined\r\n\r\nconst CurrentTransfer = function() {\r\n  return currentTransfer\r\n}\r\nconst TransferWorker = function (task, onCompleition) {\r\n  if (task instanceof Transfer === false) {\r\n    throw new Error('task is not of type Task')\r\n  }\r\n  if (!onCompleition) {\r\n    throw new Error('onCompleition is not set')\r\n  }\r\n  currentTransfer = task\r\n  task.begin()\r\n  const intervalTimer = setInterval(() => {\r\n    if (task.state === TransferStates.Failed) {\r\n      clearInterval(intervalTimer)\r\n      task.end()\r\n      currentTransfer = undefined\r\n      onCompleition('Failed Transfer')\r\n    } else if (task.state === TransferStates.Completed) {\r\n      clearInterval(intervalTimer)\r\n      task.end()\r\n      currentTransfer = undefined\r\n      onCompleition()\r\n    }\r\n  }, 500)\r\n}\r\n\r\nmodule.exports.CurrentTransfer = CurrentTransfer\r\nmodule.exports.TransferWorker = TransferWorker\r\n"]}