{"version":3,"sources":["../../../src/models/transfer/transfer-worker.js"],"names":["currentTransfer","undefined","CurrentTransfer","TransferWorker","task","onCompleition","Error","begin","intervalTimer","setInterval","state","Failed","clearInterval","end","Completed","module","exports"],"mappings":";;AAOA;;;;AACA;;;;;;AAEA,IAAIA,kBAAkBC,SAAtB;;AAEA,IAAMC,kBAAkB,SAAlBA,eAAkB,GAAW;AACjC,SAAOF,eAAP;AACD,CAFD;AAGA,IAAMG,iBAAiB,SAAjBA,cAAiB,CAAUC,IAAV,EAAgBC,aAAhB,EAA+B;AACpD,MAAID,uCAA6B,KAAjC,EAAwC;AACtC,UAAM,IAAIE,KAAJ,CAAU,0BAAV,CAAN;AACD;AACD,MAAI,CAACD,aAAL,EAAoB;AAClB,UAAM,IAAIC,KAAJ,CAAU,0BAAV,CAAN;AACD;AACDN,oBAAkBI,IAAlB;AACAA,OAAKG,KAAL;AACA,MAAMC,gBAAgBC,YAAY,YAAM;AACtC,QAAIL,KAAKM,KAAL,KAAe,iBAAeC,MAAlC,EAA0C;AACxCC,oBAAcJ,aAAd;AACAJ,WAAKS,GAAL;AACAb,wBAAkBC,SAAlB;AACAI,oBAAc,iBAAd;AACD,KALD,MAKO,IAAID,KAAKM,KAAL,KAAe,iBAAeI,SAAlC,EAA6C;AAClDF,oBAAcJ,aAAd;AACAJ,WAAKS,GAAL;AACAb,wBAAkBC,SAAlB;AACAI;AACD;AACF,GAZqB,EAYnB,GAZmB,CAAtB;AAaD,CAtBD;;AAwBAU,OAAOC,OAAP,CAAed,eAAf,GAAiCA,eAAjC;AACAa,OAAOC,OAAP,CAAeb,cAAf,GAAgCA,cAAhC","file":"transfer-worker.js","sourcesContent":["/**\nTransfer class represents a binary file inside a firmware update zip.\nA firmware update consists of a init package and data file. The StateMachine\nparases the zip file and creates a transfer object for each entry in the zip\n\nThe statemachine uses a queue to slot the Transfers in order\n**/\nimport Transfer from './transfer'\nimport TransferStates from './states'\n\nlet currentTransfer = undefined\n\nconst CurrentTransfer = function() {\n  return currentTransfer\n}\nconst TransferWorker = function (task, onCompleition) {\n  if (task instanceof Transfer === false) {\n    throw new Error('task is not of type Task')\n  }\n  if (!onCompleition) {\n    throw new Error('onCompleition is not set')\n  }\n  currentTransfer = task\n  task.begin()\n  const intervalTimer = setInterval(() => {\n    if (task.state === TransferStates.Failed) {\n      clearInterval(intervalTimer)\n      task.end()\n      currentTransfer = undefined\n      onCompleition('Failed Transfer')\n    } else if (task.state === TransferStates.Completed) {\n      clearInterval(intervalTimer)\n      task.end()\n      currentTransfer = undefined\n      onCompleition()\n    }\n  }, 500)\n}\n\nmodule.exports.CurrentTransfer = CurrentTransfer\nmodule.exports.TransferWorker = TransferWorker\n"]}