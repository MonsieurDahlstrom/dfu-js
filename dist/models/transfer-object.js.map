{"version":3,"sources":["../../src/models/transfer-object.js"],"names":["WriteActions","TransferObjectType","Command","Data","TransferObjectState","NotStarted","Creating","Transfering","Storing","Completed","Failed","TransferObject","offset","length","transfer","transferType","type","state","chunks","min","max","module","exports"],"mappings":";;;;;;;;;;AAqBA;;;;AACA;;IAAYA,Y;;AACZ;;;;;;;;AAWA,IAAMC,qBAAqB;AACzBC,WAAS,IADgB;AAEzBC,QAAM;AAFmB,CAA3B;;AAMA,IAAMC,sBAAsB;AAC1BC,cAAY,IADc;AAE1BC,YAAU,IAFgB;AAG1BC,eAAa,IAHa;AAI1BC,WAAS,IAJiB;AAK1BC,aAAW,IALe;AAM1BC,UAAQ;AANkB,CAA5B;;IAcMC,c;AAEJ,0BAAaC,MAAb,EAAqBC,MAArB,EAA6BC,QAA7B,EAAuCC,YAAvC,EAAqD;AAAA;;AAEnD,SAAKD,QAAL,GAAgBA,QAAhB;;AAEA,SAAKF,MAAL,GAAcA,MAAd;;AAEA,SAAKC,MAAL,GAAcA,MAAd;;AAEA,SAAKG,IAAL,GAAYD,YAAZ;;AAEA,SAAKE,KAAL,GAAab,oBAAoBC,UAAjC;;AAEA,SAAKa,MAAL,GAAc,EAAd;AACD;;;;8BAGUN,M,EAAQ;AACjB,UAAIO,MAAM,KAAKP,MAAf;AACA,UAAIQ,MAAMD,MAAM,KAAKN,MAArB;AACA,aAAOD,UAAUO,GAAV,IAAiBP,UAAUQ,GAAlC;AACD;;;;;AAIHC,OAAOC,OAAP,CAAeX,cAAf,GAAgCA,cAAhC;AACAU,OAAOC,OAAP,CAAelB,mBAAf,GAAqCA,mBAArC;AACAiB,OAAOC,OAAP,CAAerB,kBAAf,GAAoCA,kBAApC","file":"transfer-object.js","sourcesContent":["// Copyright (c) 2017 Monsieur DahlstrÃ¶m Ltd\r\n//\r\n// Permission is hereby granted, free of charge, to any person obtaining a\r\n// copy of this software and associated documentation files (the\r\n// \"Software\"), to deal in the Software without restriction, including\r\n// without limitation the rights to use, copy, modify, merge, publish,\r\n// distribute, sublicense, and/or sell copies of the Software, and to permit\r\n// persons to whom the Software is furnished to do so, subject to the\r\n// following conditions:\r\n//\r\n// The above copyright notice and this permission notice shall be included\r\n// in all copies or substantial portions of the Software.\r\n//\r\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\r\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\r\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\r\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\r\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\r\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\r\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n\r\nimport crc from 'crc'\r\nimport * as WriteActions from './write'\r\nimport TransmissionStatus from './transmission-types'\r\n\r\n// import {Task, TaskType, TaskResult} from './Task'\r\n\r\n\r\n\r\n/**\r\nNordic defines two different type of file transfers:\r\n    init package is known as Command object\r\n    firmware is known as Data object\r\n**/\r\nconst TransferObjectType = {\r\n  Command: 0x01,\r\n  Data: 0x02\r\n}\r\n\r\n/** Different states a TransferObject can be in **/\r\nconst TransferObjectState = {\r\n  NotStarted: 0x01,\r\n  Creating: 0x02,\r\n  Transfering: 0x03,\r\n  Storing: 0x04,\r\n  Completed: 0x05,\r\n  Failed: 0x06\r\n}\r\n\r\n/**\r\nNRF51/52 can not process a a whole binary file in one go,\r\nthe transfer of a full binary file is done by creating a string of TransferObjects\r\nwith a maximum size that the MCU reports via bluewooth\r\n**/\r\nclass TransferObject {\r\n\r\n  constructor (offset, length, transfer, transferType) {\r\n    // Reference to parent transfer that stores the file data\r\n    this.transfer = transfer\r\n    // The offset into the file data\r\n    this.offset = offset\r\n    // How long this object is\r\n    this.length = length\r\n    // TransferObjectType for this transfer object\r\n    this.type = transferType\r\n    // Initial state\r\n    this.state = TransferObjectState.NotStarted\r\n    //array that tracks all packages of data that needs to be transfered\r\n    this.chunks = []\r\n  }\r\n\r\n  /** convinence, returns a boolean for if a specific offset represents this object **/\r\n  hasOffset (offset) {\r\n    let min = this.offset\r\n    let max = min + this.length\r\n    return offset >= min && offset <= max\r\n  }\r\n\r\n}\r\n\r\nmodule.exports.TransferObject = TransferObject\r\nmodule.exports.TransferObjectState = TransferObjectState\r\nmodule.exports.TransferObjectType = TransferObjectType\r\n"]}