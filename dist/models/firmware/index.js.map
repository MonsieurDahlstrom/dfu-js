{"version":3,"sources":["../../../src/models/firmware/index.js"],"names":["FirmwareType","Application","Bootloader","Softdevice","SoftdeviceBootloader","Invalid","NotConfigured","NOT_IN_USE_1","NOT_IN_USE_2","Firmware","zipFile","Error","type","zip","sections","file","async","content","json","JSON","parse","manifest","application","bin_file","bin","dat_file","dat","section","push","console","log","bootloader","softdevice","softdevice_bootloader","module","exports","FirmwareSection"],"mappings":"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","file":"index.js","sourcesContent":["// Copyright (c) 2017 Monsieur Dahlstr√∂m Ltd\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\nimport JSZip from 'jszip'\nimport {Section} from './Section'\n\n/**\n  The different types of firmware updates a zip file can represent\n    currently only Application is fully implmented\n    http://infocenter.nordicsemi.com/topic/com.nordic.infocenter.sdk5.v12.2.0/ble_sdk_app_dfu_bootloader.html?cp=4_0_1_4_2_3_2#lib_dfu_image\n**/\nconst FirmwareType = {\n  Application: 0x01,\n  Bootloader: 0x02,\n  Softdevice: 0x04,\n  SoftdeviceBootloader: 0x08,\n  Invalid: 0x10,\n  NotConfigured: 0x20,\n  NOT_IN_USE_1: 0x40,\n  NOT_IN_USE_2: 0x80\n}\n\n/**\nFirmware, instances takes a zip file as input and unpacks the compressed update\n**/\nclass Firmware {\n\n  /** Create a new instance based on zip file and set inital state **/\n  constructor (zipFile) {\n    if (zipFile == null) {\n      throw new Error('Firmware zip is invalid')\n    }\n    this.type = FirmwareType.NotConfigured\n    this.zip = zipFile\n    this.sections = []\n  }\n\n  /** parses the manifest and unpack the binaries **/\n  async parseManifest () {\n    let content = await this.zip.file('manifest.json').async('string')\n    let json = JSON.parse(content)\n    if (json.manifest.application) {\n      try {\n        let bin = await this.zip.file(json.manifest.application.bin_file).async('uint8Array')\n        let dat = await this.zip.file(json.manifest.application.dat_file).async('uint8Array')\n        let section = new Section(bin, dat, FirmwareType.Application)\n        this.sections.push(section)\n        this.type = FirmwareType.Application\n      } catch (e) {\n        console.log(e)\n      }\n    } else if (json.manifest.bootloader) {\n      try {\n        let bin = await this.zip.file(json.manifest.bootloader.bin_file).async(\"uint8array\")\n        let dat = await this.zip.file(json.manifest.bootloader.dat_file).async(\"uint8array\")\n        let section = new Section(bin, dat, FirmwareType.Bootloader)\n        this.sections.push(section)\n        this.type = FirmwareType.Bootloader\n      } catch (e) {\n        console.log('WWFirmwareUpdate.parseManifest bootloader ' + e)\n      }\n    } else if (json.manifest.softdevice) {\n      try {\n        let bin = await this.zip.file(json.manifest.softdevice.bin_file).async(\"uint8array\")\n        let dat = await this.zip.file(json.manifest.softdevice.dat_file).async(\"uint8array\")\n        let section = new Section(bin, dat, FirmwareType.Application)\n        this.sections.push(section)\n        this.type = FirmwareType.Softdevice\n      } catch (e) {\n        console.log('WWFirmwareUpdate.parseManifest softdevice ' + e)\n      }\n    } else if (json.manifest.softdevice_bootloader) {\n      try {\n        let bin = await this.zip.file(json.manifest.softdevice_bootloader.bin_file).async(\"uint8array\")\n        let dat = await this.zip.file(json.manifest.softdevice_bootloader.dat_file).async(\"uint8array\")\n        let section = new Section(bin, dat, FirmwareType.SoftdeviceBootloader)\n        this.sections.push(section)\n        this.type = FirmwareType.SoftdeviceBootloader\n      } catch (e) {\n        console.log('WWFirmwareUpdate.parseManifest softdevice & bootloader ' + e)\n      }\n\n    } else {\n      this.type = FirmwareType.Invalid\n    }\n    return this\n  }\n}\n\nmodule.exports.Firmware = Firmware\nmodule.exports.FirmwareType = FirmwareType\nmodule.exports.FirmwareSection = Section\n"]}