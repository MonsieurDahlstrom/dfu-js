
"use strict";

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var cov_232hcgi1nm = function () {
  var path = '/Users/mdahlstrom/Documents/GitHub/web-bluetooth-dfu/src/models/task/index.js',
      hash = '87e6156ff0c8998c24afbe70be56ea8da29d5c86',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/mdahlstrom/Documents/GitHub/web-bluetooth-dfu/src/models/task/index.js',
    statementMap: {
      '0': {
        start: {
          line: 29,
          column: 4
        },
        end: {
          line: 29,
          column: 34
        }
      },
      '1': {
        start: {
          line: 30,
          column: 4
        },
        end: {
          line: 30,
          column: 30
        }
      },
      '2': {
        start: {
          line: 31,
          column: 4
        },
        end: {
          line: 31,
          column: 49
        }
      },
      '3': {
        start: {
          line: 35,
          column: 4
        },
        end: {
          line: 37,
          column: 5
        }
      },
      '4': {
        start: {
          line: 36,
          column: 6
        },
        end: {
          line: 36,
          column: 46
        }
      },
      '5': {
        start: {
          line: 38,
          column: 4
        },
        end: {
          line: 40,
          column: 5
        }
      },
      '6': {
        start: {
          line: 39,
          column: 6
        },
        end: {
          line: 39,
          column: 49
        }
      },
      '7': {
        start: {
          line: 41,
          column: 4
        },
        end: {
          line: 49,
          column: 5
        }
      },
      '8': {
        start: {
          line: 42,
          column: 6
        },
        end: {
          line: 42,
          column: 55
        }
      },
      '9': {
        start: {
          line: 43,
          column: 6
        },
        end: {
          line: 45,
          column: 13
        }
      },
      '10': {
        start: {
          line: 44,
          column: 8
        },
        end: {
          line: 44,
          column: 23
        }
      },
      '11': {
        start: {
          line: 47,
          column: 6
        },
        end: {
          line: 47,
          column: 28
        }
      },
      '12': {
        start: {
          line: 48,
          column: 6
        },
        end: {
          line: 48,
          column: 42
        }
      },
      '13': {
        start: {
          line: 53,
          column: 19
        },
        end: {
          line: 53,
          column: 51
        }
      },
      '14': {
        start: {
          line: 54,
          column: 4
        },
        end: {
          line: 54,
          column: 42
        }
      },
      '15': {
        start: {
          line: 55,
          column: 4
        },
        end: {
          line: 55,
          column: 36
        }
      },
      '16': {
        start: {
          line: 56,
          column: 4
        },
        end: {
          line: 56,
          column: 70
        }
      },
      '17': {
        start: {
          line: 60,
          column: 19
        },
        end: {
          line: 60,
          column: 51
        }
      },
      '18': {
        start: {
          line: 61,
          column: 4
        },
        end: {
          line: 61,
          column: 42
        }
      },
      '19': {
        start: {
          line: 62,
          column: 4
        },
        end: {
          line: 62,
          column: 36
        }
      },
      '20': {
        start: {
          line: 64,
          column: 4
        },
        end: {
          line: 64,
          column: 39
        }
      },
      '21': {
        start: {
          line: 65,
          column: 4
        },
        end: {
          line: 65,
          column: 70
        }
      },
      '22': {
        start: {
          line: 69,
          column: 19
        },
        end: {
          line: 69,
          column: 51
        }
      },
      '23': {
        start: {
          line: 70,
          column: 4
        },
        end: {
          line: 70,
          column: 43
        }
      },
      '24': {
        start: {
          line: 72,
          column: 4
        },
        end: {
          line: 72,
          column: 45
        }
      },
      '25': {
        start: {
          line: 73,
          column: 4
        },
        end: {
          line: 73,
          column: 71
        }
      },
      '26': {
        start: {
          line: 77,
          column: 4
        },
        end: {
          line: 77,
          column: 43
        }
      },
      '27': {
        start: {
          line: 81,
          column: 19
        },
        end: {
          line: 81,
          column: 51
        }
      },
      '28': {
        start: {
          line: 82,
          column: 4
        },
        end: {
          line: 82,
          column: 54
        }
      },
      '29': {
        start: {
          line: 83,
          column: 4
        },
        end: {
          line: 83,
          column: 82
        }
      },
      '30': {
        start: {
          line: 87,
          column: 19
        },
        end: {
          line: 87,
          column: 51
        }
      },
      '31': {
        start: {
          line: 88,
          column: 4
        },
        end: {
          line: 88,
          column: 43
        }
      },
      '32': {
        start: {
          line: 89,
          column: 4
        },
        end: {
          line: 89,
          column: 71
        }
      },
      '33': {
        start: {
          line: 93,
          column: 0
        },
        end: {
          line: 93,
          column: 26
        }
      },
      '34': {
        start: {
          line: 94,
          column: 0
        },
        end: {
          line: 94,
          column: 36
        }
      },
      '35': {
        start: {
          line: 95,
          column: 0
        },
        end: {
          line: 95,
          column: 40
        }
      }
    },
    fnMap: {
      '0': {
        name: '(anonymous_0)',
        decl: {
          start: {
            line: 28,
            column: 2
          },
          end: {
            line: 28,
            column: 3
          }
        },
        loc: {
          start: {
            line: 28,
            column: 72
          },
          end: {
            line: 32,
            column: 3
          }
        },
        line: 28
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 34,
            column: 2
          },
          end: {
            line: 34,
            column: 3
          }
        },
        loc: {
          start: {
            line: 34,
            column: 44
          },
          end: {
            line: 50,
            column: 3
          }
        },
        line: 34
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 43,
            column: 17
          },
          end: {
            line: 43,
            column: 18
          }
        },
        loc: {
          start: {
            line: 43,
            column: 29
          },
          end: {
            line: 45,
            column: 7
          }
        },
        line: 43
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 52,
            column: 2
          },
          end: {
            line: 52,
            column: 3
          }
        },
        loc: {
          start: {
            line: 52,
            column: 45
          },
          end: {
            line: 57,
            column: 3
          }
        },
        line: 52
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 59,
            column: 2
          },
          end: {
            line: 59,
            column: 3
          }
        },
        loc: {
          start: {
            line: 59,
            column: 53
          },
          end: {
            line: 66,
            column: 3
          }
        },
        line: 59
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 68,
            column: 2
          },
          end: {
            line: 68,
            column: 3
          }
        },
        loc: {
          start: {
            line: 68,
            column: 68
          },
          end: {
            line: 74,
            column: 3
          }
        },
        line: 68
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 76,
            column: 2
          },
          end: {
            line: 76,
            column: 3
          }
        },
        loc: {
          start: {
            line: 76,
            column: 47
          },
          end: {
            line: 78,
            column: 3
          }
        },
        line: 76
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 80,
            column: 2
          },
          end: {
            line: 80,
            column: 3
          }
        },
        loc: {
          start: {
            line: 80,
            column: 35
          },
          end: {
            line: 84,
            column: 3
          }
        },
        line: 80
      },
      '8': {
        name: '(anonymous_8)',
        decl: {
          start: {
            line: 86,
            column: 2
          },
          end: {
            line: 86,
            column: 3
          }
        },
        loc: {
          start: {
            line: 86,
            column: 34
          },
          end: {
            line: 90,
            column: 3
          }
        },
        line: 86
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 35,
            column: 4
          },
          end: {
            line: 37,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 35,
            column: 4
          },
          end: {
            line: 37,
            column: 5
          }
        }, {
          start: {
            line: 35,
            column: 4
          },
          end: {
            line: 37,
            column: 5
          }
        }],
        line: 35
      },
      '1': {
        loc: {
          start: {
            line: 38,
            column: 4
          },
          end: {
            line: 40,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 38,
            column: 4
          },
          end: {
            line: 40,
            column: 5
          }
        }, {
          start: {
            line: 38,
            column: 4
          },
          end: {
            line: 40,
            column: 5
          }
        }],
        line: 38
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

var _types = require('./types');

var _types2 = _interopRequireDefault(_types);

var _results = require('./results');

var _results2 = _interopRequireDefault(_results);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Task = function () {
  function Task(characteristicToWriteTo, bytesToWrite, commandToExecute) {
    (0, _classCallCheck3.default)(this, Task);
    cov_232hcgi1nm.f[0]++;
    cov_232hcgi1nm.s[0]++;

    this.opcode = commandToExecute;
    cov_232hcgi1nm.s[1]++;
    this.buffer = bytesToWrite;
    cov_232hcgi1nm.s[2]++;
    this.characteristic = characteristicToWriteTo;
  }

  (0, _createClass3.default)(Task, null, [{
    key: 'Worker',
    value: function () {
      var _ref = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee(task, onCompleition) {
        return _regenerator2.default.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                cov_232hcgi1nm.f[1]++;
                cov_232hcgi1nm.s[3]++;

                if (!(task instanceof Task === false)) {
                  _context.next = 8;
                  break;
                }

                cov_232hcgi1nm.b[0][0]++;
                cov_232hcgi1nm.s[4]++;
                throw new Error('task not of type Task');

              case 8:
                cov_232hcgi1nm.b[0][1]++;

              case 9:
                cov_232hcgi1nm.s[5]++;

                if (onCompleition) {
                  _context.next = 16;
                  break;
                }

                cov_232hcgi1nm.b[1][0]++;
                cov_232hcgi1nm.s[6]++;
                throw new Error('onCompleition is not set');

              case 16:
                cov_232hcgi1nm.b[1][1]++;

              case 17:
                cov_232hcgi1nm.s[7]++;
                _context.prev = 18;
                cov_232hcgi1nm.s[8]++;
                _context.next = 22;
                return task.characteristic.writeValue(task.buffer);

              case 22:
                cov_232hcgi1nm.s[9]++;

                setTimeout(function () {
                  cov_232hcgi1nm.f[2]++;
                  cov_232hcgi1nm.s[10]++;

                  onCompleition();
                }, 100);
                _context.next = 32;
                break;

              case 26:
                _context.prev = 26;
                _context.t0 = _context['catch'](18);
                cov_232hcgi1nm.s[11]++;

                console.log(_context.t0);
                cov_232hcgi1nm.s[12]++;
                onCompleition('BLE Transfer Failed');

              case 32:
              case 'end':
                return _context.stop();
            }
          }
        }, _callee, this, [[18, 26]]);
      }));

      function Worker(_x, _x2) {
        return _ref.apply(this, arguments);
      }

      return Worker;
    }()
  }, {
    key: 'verify',
    value: function verify(objectType, characteristic) {
      cov_232hcgi1nm.f[3]++;

      var dataView = (cov_232hcgi1nm.s[13]++, new DataView(new ArrayBuffer(2)));
      cov_232hcgi1nm.s[14]++;
      dataView.setUint8(0, _types2.default.SELECT);
      cov_232hcgi1nm.s[15]++;
      dataView.setUint8(1, objectType);
      cov_232hcgi1nm.s[16]++;
      return new Task(characteristic, dataView.buffer, _types2.default.SELECT);
    }
  }, {
    key: 'create',
    value: function create(objectType, length, characteristic) {
      cov_232hcgi1nm.f[4]++;

      var dataView = (cov_232hcgi1nm.s[17]++, new DataView(new ArrayBuffer(6)));
      cov_232hcgi1nm.s[18]++;
      dataView.setUint8(0, _types2.default.CREATE);
      cov_232hcgi1nm.s[19]++;
      dataView.setUint8(1, objectType);
      cov_232hcgi1nm.s[20]++;

      dataView.setUint32(2, length, true);
      cov_232hcgi1nm.s[21]++;
      return new Task(characteristic, dataView.buffer, _types2.default.CREATE);
    }
  }, {
    key: 'setPacketReturnNotification',
    value: function setPacketReturnNotification(packageCount, characteristic) {
      cov_232hcgi1nm.f[5]++;

      var dataView = (cov_232hcgi1nm.s[22]++, new DataView(new ArrayBuffer(3)));
      cov_232hcgi1nm.s[23]++;
      dataView.setUint8(0, _types2.default.SET_PRN);
      cov_232hcgi1nm.s[24]++;

      dataView.setUint16(1, packageCount, true);
      cov_232hcgi1nm.s[25]++;
      return new Task(characteristic, dataView.buffer, _types2.default.SET_PRN);
    }
  }, {
    key: 'writePackage',
    value: function writePackage(buffer, characteristic) {
      cov_232hcgi1nm.f[6]++;
      cov_232hcgi1nm.s[26]++;

      return new Task(characteristic, buffer);
    }
  }, {
    key: 'checksum',
    value: function checksum(characteristic) {
      cov_232hcgi1nm.f[7]++;

      var dataView = (cov_232hcgi1nm.s[27]++, new DataView(new ArrayBuffer(1)));
      cov_232hcgi1nm.s[28]++;
      dataView.setUint8(0, _types2.default.CALCULATE_CHECKSUM);
      cov_232hcgi1nm.s[29]++;
      return new Task(characteristic, dataView.buffer, _types2.default.CALCULATE_CHECKSUM);
    }
  }, {
    key: 'execute',
    value: function execute(characteristic) {
      cov_232hcgi1nm.f[8]++;

      var dataView = (cov_232hcgi1nm.s[30]++, new DataView(new ArrayBuffer(1)));
      cov_232hcgi1nm.s[31]++;
      dataView.setUint8(0, _types2.default.EXECUTE);
      cov_232hcgi1nm.s[32]++;
      return new Task(characteristic, dataView.buffer, _types2.default.EXECUTE);
    }
  }]);
  return Task;
}();

cov_232hcgi1nm.s[33]++;


module.exports.Task = Task;
cov_232hcgi1nm.s[34]++;
module.exports.TaskTypes = _types2.default;
cov_232hcgi1nm.s[35]++;
module.exports.TaskResults = _results2.default;
//# sourceMappingURL=index.js.map